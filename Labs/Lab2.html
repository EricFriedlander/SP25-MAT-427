<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eric Friedlander">

<title>Lab 2: Introduction to Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lab2_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lab2_files/libs/quarto-html/quarto.js"></script>
<script src="Lab2_files/libs/quarto-html/popper.min.js"></script>
<script src="Lab2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lab2_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lab2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lab2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lab2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lab2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lab2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Introduction to Regression</h1>
<p class="subtitle lead">MAT 427: Spring ’25</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eric Friedlander </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="prework" class="level2">
<h2 class="anchored" data-anchor-id="prework">Prework</h2>
<ul>
<li>Read Chapter 3 from ISLR.</li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<!-- A **regression model** is a model for predicting numeric outcomes. This is in contrast to **classification** models which are meant for predicting categories/labels/classes. Both are considered forms of **supervised** learning meaning we train our models knowing what the outcomes are for our training set.  -->
<p>In this lab, we’ll be using linear regression to introduce the process of building a predictive regression model. <strong>Linear regression</strong> is a simple method for predicting a quantitative response variable <span class="math inline">\(Y\)</span> on the basis of multiple predictors. That is, we assume that</p>
<p><span class="math display">\[
\begin{aligned}
Y = \beta_0 + \beta_1 X_1 + \beta_2X_2 + \ldots + \beta_n X_m.
\end{aligned}
\]</span></p>
<p>Based on this model, given values <span class="math inline">\(x_1, \ldots, x_m\)</span> for the predictors, we predict the response variable to be</p>
<p><span class="math display">\[
\begin{aligned}
\hat y = \beta_0 + \beta_1 x_1 + \beta_2x_2 + \ldots + \beta_m x_m.
\end{aligned}
\]</span></p>
<p>Note that we typically use hats (i.e.&nbsp;<span class="math inline">\(\hat{y}\)</span> ) to denote <em>predictions</em>. For the <span class="math inline">\(i\)</span>th observation, the difference between the true response <span class="math inline">\(y_i\)</span> and our predicted response <span class="math inline">\(\hat y_i\)</span> is <span class="math inline">\(e_i = y_i - \hat y_i\)</span>, which we call the <span class="math inline">\(i\)</span>th <strong>residual</strong>. The coefficients of a linear model are usually chosen using the <strong>least squares criterion</strong>. That is, if we have <span class="math inline">\(n\)</span> observations on which to base our model, we choose the values of <span class="math inline">\(\beta_0, \beta_1, \ldots, \beta_m\)</span> to minimize the <strong>Mean Squared Error</strong> (MSE), which is defined as:</p>
<p><span class="math display">\[
\begin{aligned}
(e_1^2 + e_2^2 + \ldots + e_m^2)/m.
\end{aligned}
\]</span></p>
<p>There is a lot of statistical theory behind multiple linear regression which is explored in depth in other courses (namely Multiple Regression Analysis and Linear Algebra). The basis of this theory is the assumption that the true relationship between the predictors and the response variable is given by</p>
<p><span class="math display">\[
\begin{aligned}
Y = \beta_0 + \beta_1 X_1 + \beta_2X_2 + \ldots + \beta_m X_m + \epsilon
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\epsilon\)</span> is a normally distributed mean-zero random error term. Based on these assumptions, there are a number of metrics for assessing which variables are important in our model, which we can learn from the <code>summary()</code> function in R. For the purposes of this course, we should know that the coefficients tell us how a one unit change in one of the predictors affects the response. We should also know that the p-values tell us how confident we can be that one of the coefficients is different from zero, where p-values close to 0 imply high confidence and p-values close to 1 imply low confidence.</p>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<p>In this lab, you will practice multiple linear regression by working with the data set <code>Carseats</code> from the package <code>ISLR2</code>. This data set contains simulated data of child car seat sales at 400 different stores. Your prediction task in this lab will be to predict <code>Sales</code> from some combination of the other variables. Look at the help documentation for this data to explore the available variables.</p>
<blockquote class="blockquote">
<ol type="1">
<li>Load the <code>ISLR</code> package and then load the data set <code>Carseats</code>. What is <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> for this data set?</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Carseats)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(Carseats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 400
Columns: 11
$ Sales       &lt;dbl&gt; 9.50, 11.22, 10.06, 7.40, 4.15, 10.81, 6.63, 11.85, 6.54, …
$ CompPrice   &lt;dbl&gt; 138, 111, 113, 117, 141, 124, 115, 136, 132, 132, 121, 117…
$ Income      &lt;dbl&gt; 73, 48, 35, 100, 64, 113, 105, 81, 110, 113, 78, 94, 35, 2…
$ Advertising &lt;dbl&gt; 11, 16, 10, 4, 3, 13, 0, 15, 0, 0, 9, 4, 2, 11, 11, 5, 0, …
$ Population  &lt;dbl&gt; 276, 260, 269, 466, 340, 501, 45, 425, 108, 131, 150, 503,…
$ Price       &lt;dbl&gt; 120, 83, 80, 97, 128, 72, 108, 120, 124, 124, 100, 94, 136…
$ ShelveLoc   &lt;fct&gt; Bad, Good, Medium, Medium, Bad, Bad, Medium, Good, Medium,…
$ Age         &lt;dbl&gt; 42, 65, 59, 55, 38, 78, 71, 67, 76, 76, 26, 50, 62, 53, 52…
$ Education   &lt;dbl&gt; 17, 10, 12, 14, 13, 16, 15, 10, 10, 17, 10, 13, 18, 18, 18…
$ Urban       &lt;fct&gt; Yes, Yes, Yes, Yes, Yes, No, Yes, Yes, No, No, No, Yes, Ye…
$ US          &lt;fct&gt; Yes, Yes, Yes, Yes, No, Yes, No, Yes, No, Yes, Yes, Yes, N…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Carseats) <span class="sc">|&gt;</span> <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 4%">
<col style="width: 11%">
<col style="width: 6%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">Sales</th>
<th style="text-align: right;">CompPrice</th>
<th style="text-align: right;">Income</th>
<th style="text-align: right;">Advertising</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Price</th>
<th style="text-align: left;">ShelveLoc</th>
<th style="text-align: right;">Age</th>
<th style="text-align: right;">Education</th>
<th style="text-align: left;">Urban</th>
<th style="text-align: left;">US</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">9.50</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">120</td>
<td style="text-align: left;">Bad</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: right;">11.22</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">260</td>
<td style="text-align: right;">83</td>
<td style="text-align: left;">Good</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10.06</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">269</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="even">
<td style="text-align: right;">7.40</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">466</td>
<td style="text-align: right;">97</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.15</td>
<td style="text-align: right;">141</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">340</td>
<td style="text-align: right;">128</td>
<td style="text-align: left;">Bad</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
</tr>
<tr class="even">
<td style="text-align: right;">10.81</td>
<td style="text-align: right;">124</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">501</td>
<td style="text-align: right;">72</td>
<td style="text-align: left;">Bad</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">No</td>
<td style="text-align: left;">Yes</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><em>There are <span class="math inline">\(n = 400\)</span> observations and <span class="math inline">\(p = 11\)</span> variables.</em></p>
</section>
<section id="data-splitting" class="level2">
<h2 class="anchored" data-anchor-id="data-splitting">Data Splitting</h2>
<p>When doing empirical modeling, we should set aside a portion of our data, to be used at the end, in assessing the performance of our final model(s). In fact, we should usually split our data into three sets:</p>
<ul>
<li><strong>training set:</strong> the set of data we use to build our models</li>
<li><strong>validation set:</strong> the set of data used to compare different models and tune parameters</li>
<li><strong>test set:</strong> the set of data used to give a final estimate of our model accuracy and sometimes compare a few final candidate models</li>
</ul>
<p>The validation and test sets are frequently referred to as <strong>holdout</strong> sets since they are “held out” when we train our models. In general, the process of generating a model proceeds as follows. <em><em>Warning:</em> not everyone uses the same terminology and there is some variation in how people treat validation and test sets. For example, many people say <em>tuning set</em> instead of <em>validation set</em> and then call their <em>test set</em> the <em>validation set</em>.</em> You begin by fitting a baseline (i.e.&nbsp;simple) model on your training set and evaluate it on your validation set. You then begin to create more complex models by selecting different types of models, changing preprocessing techniques, including more variables in your model, transforming your variables, and/or many other techniques. For each of these new models, you assess the performance on your validation set. Based on the results, you select one “best” model, group your training and validation set back together, refit the model on this larger set, and then assess the performance on your test set. This will give you an estimate on how well your model will perform in the real world. Some people use the test set to help with <strong>model selection</strong>, the process of selecting the parameters, variables, and methods used for generating your model. If you do decide to do that, I recommend only comparing a few models developed using different methods. I.e. use your validation set to find the best linear regression model, regression tree, or neural network and then compare those three on the test set.</p>
<p>A word of caution: keep your train, validation, and test sets SEPARATE. It’s much easier than you think to accidentally introduce information from your validation or test set into the modeling process which may lead to models which perform worse than you think they do. This is known as <strong>data leakage</strong>. For example, say that in order to preprocess your data you decide to center and scale some of the variables. If you center and scale the data before splitting it, you will be introducing information from the validation and test sets into your modeling process. In addition, the process that you use to prepare your training data should be applied exactly to your validation and test sets. For example, if you center and scale your variables before fitting a model, make sure that you use the mean and standard deviation <em>from your training set</em> to center and scale the validation and test sets.</p>
<p>This leads us to our next questions. How big should each of these data sets be? The answer to this depends on the problem at hand. The most important factor will be how much data you actually have. If you don’t leave enough in your training set, your model will be unstable and have large variance (i.e.&nbsp;it’s predictions will be too sensitive to the specific noise in data used to fit the model). If your holdout sets are too small your estimates of prediction accuracy will not be accurate. The questions you need to ask yourself are “Do all of my data sets contain enough data to be representative of the population?”. If your data set is small and this is impossible, there are other techniques that we’ll discuss later in this course (e.g.&nbsp;cross-validation and resampling) which can make the most of a small data set. In general, you most commonly see training-validation-test splits of 60-20-20, 70-15-15, or 80-10-10. We can use the function <code>partition</code> from the <code>splitTools</code> package to create partitions of our data. In the example below, I’ve created training, validation, and test sets using the data set <code>mpg</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splitTools)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1988</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of vectors of indices for each set</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">partition</span>(mpg<span class="sc">$</span>cty, <span class="at">p =</span> <span class="fu">c</span>(<span class="at">train =</span> .<span class="dv">7</span>, <span class="at">validation =</span> .<span class="dv">15</span>, <span class="at">test =</span> .<span class="dv">15</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># We can see that splits contains a list of three vectors, one for each set</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(splits)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ train     : int [1:161] 1 2 4 6 7 8 9 10 11 12 ...
 $ validation: int [1:39] 17 18 29 34 36 39 44 48 61 63 ...
 $ test      : int [1:34] 3 5 24 27 37 41 52 60 68 69 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sets</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>training_mpg <span class="ot">&lt;-</span> mpg[splits<span class="sc">$</span>train, ]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>validation_mpg <span class="ot">&lt;-</span> mpg[splits<span class="sc">$</span>validation, ]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>test_mpg <span class="ot">&lt;-</span> mpg[splits<span class="sc">$</span>test, ]</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(training_mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 161  11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(validation_mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 39 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(test_mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 34 11</code></pre>
</div>
</div>
<p>That’s convenient! In fact, <code>partition</code> uses something called stratified sampling to ensure that the target variable is well represented in all three sets. If you’d like to not use too many packages, the <code>createDataPartition</code> from the <code>caret</code> packages works similarly however it can only split data into two sets at a time.</p>
<blockquote class="blockquote">
<ol start="2" type="1">
<li>Create a training, validation, and test set from the <code>Carseats</code> data using a 60-20-20 split. Note that this is a random process so you will get different partitions every time you split your data. As a result, it is considered good practice to set your seed so that the results are reproducible. For this lab please use the seed 427. Using the training set, create a <a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html"><em>corrplot</em> using the package <code>corrplot</code></a>. What quantitative variable is most highly correlated with <code>Sales</code>, our target variable?</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">427</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate list of vectors of indices for each set</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">partition</span>(Carseats<span class="sc">$</span>Sales, <span class="at">p =</span> <span class="fu">c</span>(<span class="at">train =</span> .<span class="dv">6</span>, <span class="at">validation =</span> .<span class="dv">2</span>, <span class="at">test =</span> .<span class="dv">2</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sets</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> Carseats[splits<span class="sc">$</span>train, ]</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>validation <span class="ot">&lt;-</span> Carseats[splits<span class="sc">$</span>validation, ]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> Carseats[splits<span class="sc">$</span>test, ]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>correlations <span class="ot">&lt;-</span> training <span class="sc">|&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span> </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>correlations <span class="sc">|&gt;</span> </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Lab2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>correlations <span class="sc">|&gt;</span> <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Sales</th>
<th style="text-align: right;">CompPrice</th>
<th style="text-align: right;">Income</th>
<th style="text-align: right;">Advertising</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Price</th>
<th style="text-align: right;">Age</th>
<th style="text-align: right;">Education</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sales</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">0.270</td>
<td style="text-align: right;">0.088</td>
<td style="text-align: right;">-0.438</td>
<td style="text-align: right;">-0.242</td>
<td style="text-align: right;">-0.120</td>
</tr>
<tr class="even">
<td style="text-align: left;">CompPrice</td>
<td style="text-align: right;">0.050</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-0.122</td>
<td style="text-align: right;">-0.015</td>
<td style="text-align: right;">-0.047</td>
<td style="text-align: right;">0.588</td>
<td style="text-align: right;">-0.122</td>
<td style="text-align: right;">0.053</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Income</td>
<td style="text-align: right;">0.125</td>
<td style="text-align: right;">-0.122</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">-0.088</td>
<td style="text-align: right;">0.023</td>
<td style="text-align: right;">-0.142</td>
</tr>
<tr class="even">
<td style="text-align: left;">Advertising</td>
<td style="text-align: right;">0.270</td>
<td style="text-align: right;">-0.015</td>
<td style="text-align: right;">0.080</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.247</td>
<td style="text-align: right;">0.053</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Population</td>
<td style="text-align: right;">0.088</td>
<td style="text-align: right;">-0.047</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">0.247</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">-0.072</td>
<td style="text-align: right;">-0.102</td>
</tr>
<tr class="even">
<td style="text-align: left;">Price</td>
<td style="text-align: right;">-0.438</td>
<td style="text-align: right;">0.588</td>
<td style="text-align: right;">-0.088</td>
<td style="text-align: right;">0.053</td>
<td style="text-align: right;">0.013</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">0.068</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Age</td>
<td style="text-align: right;">-0.242</td>
<td style="text-align: right;">-0.122</td>
<td style="text-align: right;">0.023</td>
<td style="text-align: right;">-0.004</td>
<td style="text-align: right;">-0.072</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.048</td>
</tr>
<tr class="even">
<td style="text-align: left;">Education</td>
<td style="text-align: right;">-0.120</td>
<td style="text-align: right;">0.053</td>
<td style="text-align: right;">-0.142</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">-0.102</td>
<td style="text-align: right;">0.068</td>
<td style="text-align: right;">0.048</td>
<td style="text-align: right;">1.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><em><code>Price</code> is the variable most highly correlated with <code>Sales</code>.</em></p>
</section>
<section id="fitting-our-first-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-our-first-model">Fitting Our First Model</h2>
<p>In predictive modeling, we often begin with a simple baseline model, to which we compare other models. Any more complicated model must outperform the baseline model to be considered useful. We can use the <code>lm</code> function to fit a linear model and either the <code>summary</code> function or the <code>broom</code> package to summarize our model. The <code>broom</code> package provides three main functions which work with most models, converting them into more tidyverse friendly formats. These functions are <code>tidy</code>, <code>glance</code>, and <code>augment</code> which you can read more about <a href="https://broom.tidymodels.org/">here</a>. In the chunk below I fit a linear regression model to predict city mpg using highway mpg on the training set I created above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>baseline_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(cty <span class="sc">~</span> hwy, <span class="at">data =</span> training_mpg)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Broom</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>baseline_model <span class="sc">|&gt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">0.9592242</td>
<td style="text-align: right;">0.3826053</td>
<td style="text-align: right;">2.507086</td>
<td style="text-align: right;">0.0131774</td>
</tr>
<tr class="even">
<td style="text-align: left;">hwy</td>
<td style="text-align: right;">0.6784939</td>
<td style="text-align: right;">0.0158399</td>
<td style="text-align: right;">42.834477</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>baseline_model <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.9202525</td>
<td style="text-align: right;">0.9197509</td>
<td style="text-align: right;">1.20099</td>
<td style="text-align: right;">1834.792</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-256.9294</td>
<td style="text-align: right;">519.8588</td>
<td style="text-align: right;">529.103</td>
<td style="text-align: right;">229.338</td>
<td style="text-align: right;">159</td>
<td style="text-align: right;">161</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Summary</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>baseline_model <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = cty ~ hwy, data = training_mpg)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.9216 -0.8151  0.0075  0.6505  4.1870 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.95922    0.38261   2.507   0.0132 *  
hwy          0.67849    0.01584  42.834   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.201 on 159 degrees of freedom
Multiple R-squared:  0.9203,    Adjusted R-squared:  0.9198 
F-statistic:  1835 on 1 and 159 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<blockquote class="blockquote">
<ol start="3" type="1">
<li>Fit a linear model predicting <code>Sales</code> using the variable you identified in question 2. Write down the resulting model in the form: <span class="math display">\[
\begin{aligned}
\text{Sales} = \beta_0 + \beta_1\times\text{Variable}.
\end{aligned}
\]</span> Don’t forget to use your training set rather than the full data to train your model.</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>lm_base <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> Price, <span class="at">data =</span> training)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>lm_base <span class="sc">|&gt;</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">13.6339694</td>
<td style="text-align: right;">0.8320927</td>
<td style="text-align: right;">16.385157</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Price</td>
<td style="text-align: right;">-0.0529455</td>
<td style="text-align: right;">0.0070433</td>
<td style="text-align: right;">-7.517189</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lm_base <span class="sc">|&gt;</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 7%">
<col style="width: 2%">
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">sigma</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
<th style="text-align: right;">df</th>
<th style="text-align: right;">logLik</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df.residual</th>
<th style="text-align: right;">nobs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.1918729</td>
<td style="text-align: right;">0.1884774</td>
<td style="text-align: right;">2.528276</td>
<td style="text-align: right;">56.50813</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-562.1501</td>
<td style="text-align: right;">1130.3</td>
<td style="text-align: right;">1140.742</td>
<td style="text-align: right;">1521.338</td>
<td style="text-align: right;">238</td>
<td style="text-align: right;">240</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><em>The resulting model is of the form:</em> <span class="math display">\[
\begin{aligned}
\text{Sales} = 13.74 - 0.05384\times \text{Price}
\end{aligned}
\]</span></p>
</section>
<section id="evaluating-our-model" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-our-model">Evaluating Our Model</h2>
<p>Let’s now see how our model performs. Suppose we have a sequence of targets <span class="math inline">\(y_1,\ldots, y_n\)</span> and a sequence of predictions for these targets <span class="math inline">\(\hat{y}_1, \ldots,\hat{y}_n\)</span>, sometimes referred to a <strong>fitted values</strong>. There are two primary metrics that we’ll use to quantify performance of regression models. The first is <strong>Root Mean-Squared Error (RMSE)</strong>. The RMSE is the square-root of the <strong>Mean-Square Error</strong> which is computed as follows:</p>
<p><span class="math display">\[
\begin{aligned}
MSE = \frac{\sum_{i=1}^n(\hat{y}_i-y_i)^2}{n} = \frac{\sum_{i=1}^ne_i^2}{n}.
\end{aligned}
\]</span></p>
<p>The RMSE can be interpreted as the average distance between your predictions and the values they are trying to predict. To make predictions with our model we use the function <code>predict</code>. In addition, we can add information like residuals and fitted values to our original data set using the function <code>augment</code> from the <code>broom</code> package. In the console below I compute the RMSE on the training set and the validation set for the <code>mpg</code> baseline model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>training_mpg_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(baseline_model, training_mpg)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>training_mpg_aug <span class="sc">|&gt;</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 8%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">manufacturer</th>
<th style="text-align: left;">model</th>
<th style="text-align: right;">displ</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: left;">trans</th>
<th style="text-align: left;">drv</th>
<th style="text-align: right;">cty</th>
<th style="text-align: right;">hwy</th>
<th style="text-align: left;">fl</th>
<th style="text-align: left;">class</th>
<th style="text-align: right;">.fitted</th>
<th style="text-align: right;">.resid</th>
<th style="text-align: right;">.hat</th>
<th style="text-align: right;">.sigma</th>
<th style="text-align: right;">.cooksd</th>
<th style="text-align: right;">.std.resid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">auto(l5)</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">29</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">20.63555</td>
<td style="text-align: right;">-2.6355464</td>
<td style="text-align: right;">0.0116590</td>
<td style="text-align: right;">1.186181</td>
<td style="text-align: right;">0.0287396</td>
<td style="text-align: right;">-2.2073836</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">manual(m5)</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">29</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">20.63555</td>
<td style="text-align: right;">0.3644536</td>
<td style="text-align: right;">0.0116590</td>
<td style="text-align: right;">1.204432</td>
<td style="text-align: right;">0.0005496</td>
<td style="text-align: right;">0.3052455</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">auto(av)</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">30</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">21.31404</td>
<td style="text-align: right;">-0.3140403</td>
<td style="text-align: right;">0.0137799</td>
<td style="text-align: right;">1.204522</td>
<td style="text-align: right;">0.0004844</td>
<td style="text-align: right;">-0.2633049</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">2.8</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">manual(m5)</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">18.60006</td>
<td style="text-align: right;">-0.6000648</td>
<td style="text-align: right;">0.0073837</td>
<td style="text-align: right;">1.203832</td>
<td style="text-align: right;">0.0009354</td>
<td style="text-align: right;">-0.5014966</td>
</tr>
<tr class="odd">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">2008</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">auto(av)</td>
<td style="text-align: left;">f</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">27</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">19.27856</td>
<td style="text-align: right;">-1.2785587</td>
<td style="text-align: right;">0.0084609</td>
<td style="text-align: right;">1.200446</td>
<td style="text-align: right;">0.0048767</td>
<td style="text-align: right;">-1.0691196</td>
</tr>
<tr class="even">
<td style="text-align: left;">audi</td>
<td style="text-align: left;">a4 quattro</td>
<td style="text-align: right;">1.8</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">manual(m5)</td>
<td style="text-align: left;">4</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">26</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;">compact</td>
<td style="text-align: right;">18.60006</td>
<td style="text-align: right;">-0.6000648</td>
<td style="text-align: right;">0.0073837</td>
<td style="text-align: right;">1.203832</td>
<td style="text-align: right;">0.0009354</td>
<td style="text-align: right;">-0.5014966</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>training_mpg_RMSE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(training_mpg_aug<span class="sc">$</span>.resid<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>validation_mpg_RMSE <span class="ot">&lt;-</span> validation_mpg <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yhat =</span> <span class="fu">predict</span>(baseline_model, validation_mpg),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">residuals =</span> cty <span class="sc">-</span> yhat) <span class="sc">|&gt;</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">RMSE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The training RMSE is 1.194 and the validation RMSE is 1.361.</p>
<blockquote class="blockquote">
<ol start="4" type="1">
<li>Compute the RMSE for your baseline model on both the training and validation sets and report them. Give you answer as a full sentence.</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>training_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(lm_base, training)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check out the info augment adds to our training data frame</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>training_aug <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 3%">
<col style="width: 6%">
<col style="width: 2%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">.rownames</th>
<th style="text-align: right;">Sales</th>
<th style="text-align: right;">CompPrice</th>
<th style="text-align: right;">Income</th>
<th style="text-align: right;">Advertising</th>
<th style="text-align: right;">Population</th>
<th style="text-align: right;">Price</th>
<th style="text-align: left;">ShelveLoc</th>
<th style="text-align: right;">Age</th>
<th style="text-align: right;">Education</th>
<th style="text-align: left;">Urban</th>
<th style="text-align: left;">US</th>
<th style="text-align: right;">.fitted</th>
<th style="text-align: right;">.resid</th>
<th style="text-align: right;">.hat</th>
<th style="text-align: right;">.sigma</th>
<th style="text-align: right;">.cooksd</th>
<th style="text-align: right;">.std.resid</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">9.50</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">120</td>
<td style="text-align: left;">Bad</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">7.280514</td>
<td style="text-align: right;">2.2194859</td>
<td style="text-align: right;">0.0043006</td>
<td style="text-align: right;">2.529481</td>
<td style="text-align: right;">0.0016715</td>
<td style="text-align: right;">0.8797593</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">10.06</td>
<td style="text-align: right;">113</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">269</td>
<td style="text-align: right;">80</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">59</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">9.398333</td>
<td style="text-align: right;">0.6616675</td>
<td style="text-align: right;">0.0141385</td>
<td style="text-align: right;">2.533234</td>
<td style="text-align: right;">0.0004982</td>
<td style="text-align: right;">0.2635770</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">7.40</td>
<td style="text-align: right;">117</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">466</td>
<td style="text-align: right;">97</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">14</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">8.498260</td>
<td style="text-align: right;">-1.0982597</td>
<td style="text-align: right;">0.0069230</td>
<td style="text-align: right;">2.532592</td>
<td style="text-align: right;">0.0006623</td>
<td style="text-align: right;">-0.4359023</td>
</tr>
<tr class="even">
<td style="text-align: left;">5</td>
<td style="text-align: right;">4.15</td>
<td style="text-align: right;">141</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">340</td>
<td style="text-align: right;">128</td>
<td style="text-align: left;">Bad</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">6.856950</td>
<td style="text-align: right;">-2.7069504</td>
<td style="text-align: right;">0.0053131</td>
<td style="text-align: right;">2.527462</td>
<td style="text-align: right;">0.0030779</td>
<td style="text-align: right;">-1.0735263</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: right;">6.63</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">108</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">71</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">No</td>
<td style="text-align: right;">7.915860</td>
<td style="text-align: right;">-1.2858596</td>
<td style="text-align: right;">0.0046444</td>
<td style="text-align: right;">2.532220</td>
<td style="text-align: right;">0.0006063</td>
<td style="text-align: right;">-0.5097767</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: right;">11.85</td>
<td style="text-align: right;">136</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">425</td>
<td style="text-align: right;">120</td>
<td style="text-align: left;">Good</td>
<td style="text-align: right;">67</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">7.280514</td>
<td style="text-align: right;">4.5694859</td>
<td style="text-align: right;">0.0043006</td>
<td style="text-align: right;">2.516081</td>
<td style="text-align: right;">0.0070848</td>
<td style="text-align: right;">1.8112517</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute RMSE</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>training_RMSE <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(training_aug<span class="sc">$</span>.resid<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>validation_RMSE <span class="ot">&lt;-</span> validation <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yhat =</span> <span class="fu">predict</span>(lm_base, validation),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">residuals =</span> Sales <span class="sc">-</span> yhat) <span class="sc">|&gt;</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">RMSE =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>The RMSE on our training set is <code>r</code>round(training_RMSE, 3)` and on our validation set is 2.456.</em></p>
<p>The second primary metric that we can use to assess the accuracy of regression models is called the <strong>coefficient of determination</strong>, denoted <span class="math inline">\(R^2\)</span>. <span class="math inline">\(R^2\)</span> is the proportion of variance (information) in our target variable that is explained by our model and can be computed by squaring <span class="math inline">\(R\)</span>, the correlation coefficient between the target variable <span class="math inline">\(y\)</span> and the predicted target <span class="math inline">\(\hat{y}\)</span>. The <code>lm</code> function actually computes the <span class="math inline">\(R^2\)</span> of our training data for us which we can access using either the <code>summary</code> function or the <code>glance</code> function from the <code>broom</code> package. Below, I use the <code>glance</code> function to get <span class="math inline">\(R^2\)</span> on the training set for the <code>mpg</code> data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rsquared_mpg_train <span class="ot">&lt;-</span> baseline_model <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resulting <span class="math inline">\(R^2\)</span> is 0.92. This implies that 92% of the variance in <code>cty</code> for our training data can be explained using only <code>hwy</code> which is, perhaps, not surprising. Computing <span class="math inline">\(R^2\)</span> on a holdout set will take slightly more work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rsquared_mpg_validation <span class="ot">&lt;-</span> <span class="fu">cor</span>(validation_mpg<span class="sc">$</span>cty, <span class="fu">predict</span>(baseline_model, validation_mpg))<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <span class="math inline">\(R^2\)</span> on the validation set is 0.912 which implies that about 91.2% of the variation in <code>cty</code> in our validation set is explained by <code>hwy</code>.</p>
<blockquote class="blockquote">
<ol start="5" type="1">
<li>What proportion of the variation in <code>Sales</code> is explained by our baseline model for the training and validation sets?</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>training_r2 <span class="ot">&lt;-</span> lm_base <span class="sc">|&gt;</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glance</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(r.squared)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>val_r2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(validation<span class="sc">$</span>Sales, <span class="fu">predict</span>(lm_base, validation))<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>We can see the about 19% of the variation in <code>Sales</code> is explained by <code>Price</code> in our training set and approximately 31% of the variation is explained in the validation set.</em></p>
<blockquote class="blockquote">
<ol start="6" type="1">
<li>Build a two-input linear model for <code>Sales</code> by adding <code>US</code> to the model. You use the syntax <code>lm(Y ~ X1 + X2, data)</code>. Save your model as <code>lmfit1</code>. Use <code>summary</code> or <code>tidy</code> to output the model and write the model as a formula, as above. Use the <code>RMSE</code> and <code>R2</code> functions from the <code>caret</code> package to compute the RMSE and <span class="math inline">\(R^2\)</span> values for this new model on both the training and validation sets. How do these compare to the baseline model?</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>lmfit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> Price <span class="sc">+</span> US, training)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>lmfit1 <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)  13.2      0.843       15.6  2.65e-38
2 Price        -0.0536   0.00697     -7.70 3.77e-13
3 USYes         0.857    0.336        2.55 1.14e- 2</code></pre>
</div>
</div>
<p>_The model is:</p>
<p><span class="math display">\[ \text{Sales} = 13.17-0.05363\times \text{Price} + 0.8566\times\text{US}\]</span></p>
<p>where US is 1 if is <code>Yes</code> and 0 otherwise._</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>lm1_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(lmfit1, training)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Training set</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>lm1_tr_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(lm1_aug<span class="sc">$</span>Sales, lm1_aug<span class="sc">$</span>.fitted)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>lm1_tr_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(lm1_aug<span class="sc">$</span>Sales, lm1_aug<span class="sc">$</span>.fitted)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation set</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>lm1_pr_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmfit1, validation)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>lm1_val_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(validation<span class="sc">$</span>Sales, lm1_pr_predictions)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>lm1_val_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(validation<span class="sc">$</span>Sales, lm1_pr_predictions)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE and R2 of Training Data</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lm1_tr_rmse, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.484</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lm1_tr_R2, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.213</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RMSE and R2 of Validation Set</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lm1_val_rmse, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.346</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(lm1_val_R2, <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.391</code></pre>
</div>
</div>
<p><em>The RMSE and <span class="math inline">\(R^2\)</span> for the training data are 2.484 and <code>r</code>round(lm1_tr_R2, 3)`, respectively, which is MUCH better than the results for the baseline model. The RMSE and <span class="math inline">\(R^2\)</span> for the validation set are 2.346 and 0.391 which are similarly improved.</em></p>
</section>
<section id="overfitting-and-the-bias-variance-trade-off" class="level2">
<h2 class="anchored" data-anchor-id="overfitting-and-the-bias-variance-trade-off">Overfitting and the Bias-Variance Trade-Off</h2>
<p>One can fit polynomial terms in <code>lm</code> using the formula <code>y ~ poly(x, j, raw = TRUE)</code> where <code>j</code> is the order of polynomial you want. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>lm3degree <span class="ot">&lt;-</span> <span class="fu">lm</span>(cty <span class="sc">~</span> <span class="fu">poly</span>(hwy, <span class="dv">3</span>, <span class="at">raw=</span><span class="cn">TRUE</span>), training_mpg)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(lm3degree) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 38%">
<col style="width: 16%">
<col style="width: 14%">
<col style="width: 16%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-1.0795668</td>
<td style="text-align: right;">3.4462644</td>
<td style="text-align: right;">-0.3132571</td>
<td style="text-align: right;">0.7545011</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(hwy, 3, raw = TRUE)1</td>
<td style="text-align: right;">1.0925998</td>
<td style="text-align: right;">0.4175460</td>
<td style="text-align: right;">2.6167174</td>
<td style="text-align: right;">0.0097453</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(hwy, 3, raw = TRUE)2</td>
<td style="text-align: right;">-0.0226248</td>
<td style="text-align: right;">0.0159164</td>
<td style="text-align: right;">-1.4214737</td>
<td style="text-align: right;">0.1571624</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(hwy, 3, raw = TRUE)3</td>
<td style="text-align: right;">0.0003594</td>
<td style="text-align: right;">0.0001912</td>
<td style="text-align: right;">1.8794725</td>
<td style="text-align: right;">0.0620331</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This model is:</p>
<p><span class="math display">\[
\text{cty} = -1.080 + 1.093 \text{hwy} - 0.0226 \text{hwy}^2 + 0.00359 \text{hwy}^3
\]</span></p>
<blockquote class="blockquote">
<ol start="7" type="1">
<li>In the cell below write a for loop which fits <code>Sales</code> as a function of <code>Price</code> for polynomials of order 1 through 10. I.e. you should fit 10 models. Plot the training vs.&nbsp;validation error for each. Based on your training set, which model performs best? Based on your validation set, which model performs best? Which model do you think would be better to use in practice? Note that you can use the functions <code>RMSE</code> and <code>R2</code> from the <code>caret</code> package to more easily calculate the RMSE and <span class="math inline">\(R^2\)</span>.</li>
</ol>
</blockquote>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># for arranging output</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># define number of models</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>num_models <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># preallocate error vectors</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>rmses_training <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_models)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>r2_training <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_models)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>rmses_validation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_models)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>r2_validation <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, num_models)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>Price_avg <span class="ot">&lt;-</span> <span class="fu">mean</span>(training<span class="sc">$</span>Price)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_models){</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># first model of order i</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    newmodel <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> <span class="fu">poly</span>(Price, i, <span class="at">raw=</span><span class="cn">TRUE</span>), <span class="at">data =</span> training)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    newmodel_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(newmodel)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Training set error metrics</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    rmses_training[i] <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(newmodel_aug<span class="sc">$</span>Sales, newmodel_aug<span class="sc">$</span>.fitted)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    r2_training[i] <span class="ot">&lt;-</span> <span class="fu">R2</span>(newmodel_aug<span class="sc">$</span>Sales, newmodel_aug<span class="sc">$</span>.fitted)</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validation set error metrics</span></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>    newmodel_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(newmodel, validation)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>    rmses_validation[i] <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(validation<span class="sc">$</span>Sales, newmodel_predictions)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>    r2_validation[i] <span class="ot">&lt;-</span> <span class="fu">R2</span>(validation<span class="sc">$</span>Sales, newmodel_predictions)</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>error_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">order =</span> <span class="dv">1</span><span class="sc">:</span>num_models, rmses_training, rmses_validation, r2_training, r2_validation) <span class="sc">|&gt;</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">!</span>order, <span class="at">names_to=</span><span class="st">"error_type"</span>, <span class="at">values_to =</span> <span class="st">"error"</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> error_df <span class="sc">|&gt;</span>   </span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(error_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"rmses_training"</span>, <span class="st">"rmses_validation"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> order, <span class="at">y =</span> error, <span class="at">color=</span>error_type)) <span class="sc">+</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Polynomial Order"</span>,</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"RMSE"</span>,</span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Error Type"</span>) <span class="sc">+</span></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Training"</span>, <span class="st">"Validation"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">'blue'</span>, <span class="st">'red'</span>))  <span class="sc">+</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> error_df <span class="sc">|&gt;</span>   </span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(error_type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"r2_training"</span>, <span class="st">"r2_validation"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> order, <span class="at">y =</span> error, <span class="at">color=</span>error_type)) <span class="sc">+</span></span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Polynomial Order"</span>,</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">bquote</span>(R<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Error Type"</span>) <span class="sc">+</span></span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Training"</span>, <span class="st">"Validation"</span>), <span class="at">values =</span> <span class="fu">c</span>(<span class="st">'blue'</span>, <span class="st">'red'</span>)) <span class="sc">+</span></span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Lab2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="Lab2_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>Notice that while the metrics on the training data continue to improve whenever you increase the order of the polynomial but eventually begin to get worse on the validation set. This is because of a phenomenon known as <strong>overfitting</strong>. Overfitting occurs when your model starts matching the training TOO well. A good visualization of an overfit model is Figure 2 in <a href="https://en.wikipedia.org/wiki/Overfitting">the Wikipedia article for overfitting</a>. As you include more variables/information in your model, your performance will ALWAYS increase on your training data. This is one of the reasons we always use holdout sets. Eventually your model will begin to overalign to the noise in your training data and the accuracy on holdout sets will be level off and in most cases begin to degrade.</p>
<p>Now let’s see what happens if we add in ALL of the predictors to our model. This is sometimes referred to as the <strong>full model</strong>. To include all of your predictors in a model you can use the syntax <code>lm(Y ~ ., data)</code>. We’ll first do this with the <code>mpg</code> data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>lmfull <span class="ot">&lt;-</span> <span class="fu">lm</span>(cty <span class="sc">~</span> ., training_mpg)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>lmfull_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(lmfull, training_mpg)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Training set</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>lmfull_tr_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(lmfull_aug<span class="sc">$</span>cty, lmfull_aug<span class="sc">$</span>.fitted)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>lmfull_tr_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(lmfull_aug<span class="sc">$</span>cty, lmfull_aug<span class="sc">$</span>.fitted)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation set</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>lmfull_pr_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmfull, validation_mpg)</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>lmfull_val_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(validation_mpg<span class="sc">$</span>cty, lmfull_pr_predictions)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>lmfull_val_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(validation_mpg<span class="sc">$</span>cty, lmfull_pr_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The RMSE and <span class="math inline">\(R^2\)</span> are 0.664 and 0.975, respectively, on training set and 0.969 and 0.954 when applied to the validation set.</p>
<blockquote class="blockquote">
<ol start="8" type="1">
<li>Fit a model using all of the predictors in your training data. Call the model <code>lmfull</code>. Assess the models accuracy on the training data and the validation data, comparing it to the previous models we’ve fit, and comment on your results. Do you think overfitting is happening here? Why or why not?</li>
</ol>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>lmfull <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> ., training)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>lmfull_aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(lmfull, training)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Training set</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>lmfull_tr_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(lmfull_aug<span class="sc">$</span>Sales, lmfull_aug<span class="sc">$</span>.fitted)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>lmfull_tr_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(lmfull_aug<span class="sc">$</span>Sales, lmfull_aug<span class="sc">$</span>.fitted)</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Validation set</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>lmfull_pr_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmfull, validation)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>lmfull_val_rmse <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(validation<span class="sc">$</span>Sales, lmfull_pr_predictions)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>lmfull_val_R2 <span class="ot">&lt;-</span> <span class="fu">R2</span>(validation<span class="sc">$</span>Sales, lmfull_pr_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>The RMSE and <span class="math inline">\(R^2\)</span> for the training data are 0.961 and <code>r</code>round(lmfull_tr_R2, 3)`, respectively, which is MUCH better than the results for the baseline model. The RMSE and <span class="math inline">\(R^2\)</span> for the validation set are 1.093 and 0.865 which is similarly improved. It does not seem as if overfitting is occuring.</em></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>